---
title: "climodr"
output: 
  rmarkdown::html_vignette:
    toc: TRUE
    toc_depth: 3
    number_sections: TRUE
    highlight: tango
vignette: >
  %\VignetteIndexEntry{climodr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Welcome to climatemodeller in R, short climodr. 
This packages uses stational climate data and xy to automaticly create ready-to-use climate maps and statistics. This Vignette should guide you through the package, explain its functions and give you an idea of how to use climodr.

# Getting Started with climodr

The Idea of climodr is, to speed up climate modelling processes and make them easier to use. The package foresees that one needs to store relevant input data into one folder stucture and the package does the rest. However its also possible to split up and do the automated steps manually to adjust settings or to get into detail in certain steps. 

*more cool stuff to follow*

## Downloading climodr

To start with climodr, you first need to download and install the package from the Environmental Informatics Lab (envima) @ Marburg University from Github. To do so, you need [devtools](https://www.r-project.org/nosvn/pandoc/devtools.html) installed to your R. Once devtools is installed, you can simply add climodr by following commands.   
  
Note: It may asks you to install all packages climodr needs to execute all its functions. Please install all of those.  

```{r install}
#install climodr
#devtools::install_github("envima/climodr")

devtools::load_all()
library(climodr)
```

## How to setup climodr

Setting up climodr just requires to steps, before you can get started.  
First it requieres you to name an input- and output directory path. Use *hubs()* to create these links.  
The Output-Directory will be used to safe all final products in, like maps, statistics, etc., which should be publication-ready, if executed correctly.  
The Input-Directory is the place, where all data, which shall be used for modelling, should be saved beforehand. See [list of possible inputs](link) for further details, what kind of input-data can be used.  
Second it requieres you to give it a path for a working directory. Therefore use the *envi.create()* function. This function links in the working environment for additional data worth looking into, but also creates a temporary directory, where workflow data is stored and also deleted after not being necessary anymore. To find the temporary data, type *tempdir()* into your console to see where this data is stored. 

```{r setup env}
#setting up the environment for climodr

climodr::envi.create("E:/climodr/showcase")

```

# Pre-Processing

## Aggregate Raster-Data

To guarantee a fast working package, its key to keep the data as small as possible. One way to reach this goal is to crop all data to the smallest extent possible _(?)_. 
```{r crop data, warning = FALSE}
rast_data <- climodr::crop.all(method = "Input")
terra::plot(rast_data[[3]])

```

## Prepare tabular data for processing

```{r prep csv}
climodr::prep.csv(method = "proc", safe_output = TRUE)

#check the created csv files
csv_files <- grep("_no_NAs.csv$", list.files(envrmt$path_tworkflow), value=TRUE)
csv_files
```
## Process tabular data to monthly means
```{r proc csv}
csv_data <- climodr::proc.csv(method = "all",
                              rbind = TRUE,
                              safe_output = TRUE)
head(csv_data)
```

## Spatial aggregation of tabular data
```{r spat csv}
csv_spat <- climodr::spat.csv(method = "monthly",
                              des_file = "plot_description.csv",
                              safe_output = TRUE)
head(csv_spat)
```

## finalize tabular data for modelling

```{r finalize csv, eval = FALSE}
csv_fin <- climodr::fin.csv(method = "monthly",
                            safe_output = TRUE)
```

# Processing

## Models

timespan = Vector with last two digits of years to build models from (in this example 2017 - 2021)\
response = Vector of rows to create models for. (In this example Ta_200, rH_200, SWDR_200, P_RT_NRT)\
classifier = Vector of all model variants to be used. In this case random forest = "rf", partial-least-squares = "pls", neural networks = "nnet" and linear regression = "lm"\
\
NOTE: This constellation already creates 64 models, this will need a lot of time\
\
seed = Number to "pick randomnes". With the seed one can reproduce random pulls.\
p = Number of how much in percentage should be splitted from the data into training data.\
fold = Charackter. Method to Create Space/Time folds. "LLO", "LTO" or "LLTO".\
predrows = Vector of rownumbers used as predictors. \
k = Number of unique temporal or spatial units.\
tc_method = Train controll method. Default is crossvalidation "cv".\
metric = Summary Metric to select optimal model. Default: Root Mean Square Error "RMSE".\
```{r model, eval = FALSE}
climodr::calc.model(timespan = c(17:21),
                    response = c(6,9,12,13),
                    classifier = c("rf", "pls","nnet" ,"lm"),
                    seed = 707,
                    p = 0.8,
                    fold = "LTO",
                    predrows = c(16:57),
                    k = 12,
                    tc_method = "cv",
                    metric = "RMSE")
```

## Predictions

```{r predict, eval = FALSE}
climodr::predict()
```

## Validations

```{r validate, eval=FALSE}
climodr::validate()
```

# Plotting

## Maps

## Statistics
